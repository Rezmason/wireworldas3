<?xml version="1.0" encoding="UTF-8"?>

<project name='wwzarkov' default='default' basedir='../'>
	<target name='default'>
		<bigsource.mxmlc basedir="${basedir}" sdk="${flex.home}">  
			<default_size height="768" width="1024" />  
			<file_specs path="${swf.main.class}" />  
			<library_path path="${swc.applicationasset}" />  
			<source_path path="source/as" />  
			<output path="${swf.main.target}" />  
			<verbose_stacktraces value="true" />  
		</bigsource.mxmlc> 
	</target>
	
	<macrodef name='wwBuildZarkov'>
		
		<attribute name='brain' default='STANDARD' />
		<attribute name='dest' default='${ant.project.name}' />
		<attribute name='tdsi' default='false' />
		<attribute name='debug' default='false' />
		<attribute name='launch' default='false' />
			
		<sequential>

			<if>
				<equals arg1='@{debug}' arg2='false' />
				<then><property name='optimize' value='true' /></then>
				<else><property name='optimize' value='false' /></else>
			</if>
			
			<propertyregex property='defLine.@{brain}.first' override='false' input='${defBrains}' regexp='([^\|]+)\|' replace='${defPrefix}\1,false ' />
			<propertyregex property='defLine.@{brain}.final' input='${defLine.@{brain}.first}' regexp='(@{brain}\,)false' replace='\1true' />
			<echo message='${defLine.@{brain}.final}' />
			
			<bigsource.mxmlc basedir='${basedir}' sdk='${FLEX_HOME}'>
				<args value='${defLine.@{brain}.final}' />
				<debug value='@{debug}' />
				<optimize value='${optimize}' />
				<incremental value='true' />
				<load_config path='${FLEX_HOME}/frameworks/flex-config.xml' />
				<load_config path='${dir.src}/ww-config.xml' />
				<!--  <load_config path='${dir.src}/ww-def-config.xml' /> -->
				<l path='${APPARAT_HOME}/apparat.swc' />
				<l path='${FLEX_HOME}/frameworks/libs/flex.swc' />
				<output path='${dir.bin}/@{dest}.swf' />
				<sp path='${dir.src}'/>
				<file_specs path='${dir.src}/Wireworld.as"' />
			</bigsource.mxmlc> 

			<if>
				<equals arg1='@{tdsi}' arg2='true' />
				<then>
					<stripper in='${dir.bin}/@{dest}.swf' out='${dir.bin}/@{dest}.swf'>
						<classpath refid='apparat.path' />
					</stripper>
					<tdsi in='${dir.bin}/@{dest}.swf' out='${dir.bin}/@{dest}.swf'>
						<classpath refid='apparat.path' />
					</tdsi>  
				</then>
			</if>
			
			<if>
				<equals arg1='@{launch}' arg2='true' />
				<then><exec executable='open'><arg line='${dir.bin}/@{dest}.swf' /></exec></then>
			</if>
		</sequential>
	</macrodef>
</project>
